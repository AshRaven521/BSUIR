//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "Unit1.h"
#include "Unit2.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm1 *Form1;
List lst;

//---------------------------------------------------------------------------
__fastcall TForm1::TForm1(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------
void __fastcall TForm1::Button2Click(TObject *Sender)
{
	if(OpenDialog1->Execute())
   {
		TFileStream *file=new TFileStream(OpenDialog1->FileName.c_str(),fmOpenRead);
		/*count=(file->Size)/sizeof(Hospital);//находим кол-во объектов,сохраненных в файле
		if(count>0)
		{
			hosp=new Hospital[count];
			file->Read((void*)hosp,sizeof(Hospital)*count);
			current=count-1;

			ObjToForm();

			Label6->Caption="Количество записей: "+IntToStr(count);;
			Label7->Caption="Текущая запись: "+IntToStr(current+1);
		}
		else
		{
			MessageBox(Handle,L"Объеты в файле не найдены",L"Сообщение",NULL);
		}   */
		delete file;
   }
}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button4Click(TObject *Sender)
{
	if(SaveDialog1->Execute())
	{
		TFileStream *file = new TFileStream(SaveDialog1->FileName.c_str(),fmCreate);
		//int nWrite=file->Write((void*)hosp,sizeof(Hospital)*count);
		delete file;
	}
}
//---------------------------------------------------------------------------
void TForm1::MemoToForm(int iPal)
{
	Memo1->Lines->Clear();

	for(int i=0;i<lst.size;i++)
	{
		Products* element=lst.Pop(i);
		if( iPal==-1)
		{
			std::string str=element->name;
			AnsiString strStr=str.c_str();
			AnsiString strMemo="Наименование: "+strStr+"; Количество: ";
			strMemo=strMemo+IntToStr(element->quantity)+"; Номер цеха: ";
			strMemo=strMemo+IntToStr(element->WorkNumber)+";";

			Memo1->Lines->Add(strMemo);
		}

	}
	/*for(int i=0;i<count;i++)
	{
		if(hosp[i].number==iPal || iPal==-1)//если выполняется первое условие,то он выводит тех,кто находится в данной плате,если выполняется второе,то он выодит всех
		{
			std::string str=hosp[i].name;
			AnsiString strStr=str.c_str();
			AnsiString strMemo="ФИО: "+strStr+"; Пол: ";
			if(hosp[i].pol==0)
			{
				strStr="мужской; ";
			}
			else
			{
				strStr="женский; ";
			}
			strMemo=strMemo+strStr+"Возраст: "+IntToStr(hosp[i].age)+"; Диагноз: ";
			str=hosp[i].diagnoz;
			strStr=str.c_str();
			strMemo=strMemo+strStr+"; Номер палаты: ";
			if(hosp[i].number==0)
			{
				strStr="не выбран. ";
			}
			else
			{
				strStr=IntToStr(hosp[i].number)+".";
			}
			strMemo=strMemo+strStr;
			Memo1->Lines->Add(strMemo);
		}
	}   */
}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button9Click(TObject *Sender)
{
	MemoToForm(-1);
}
//---------------------------------------------------------------------------


void __fastcall TForm1::Button8Click(TObject *Sender)
{
	/*if(current<count-1)
	{
		current++;
		ObjToForm();
		Label7->Caption="Текущая запись: "+IntToStr(current+1);
	} */
}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button7Click(TObject *Sender)
{
	/*if(current>0)
	{
		current--;
		ObjToForm();
		Label7->Caption="Текущая запись: "+IntToStr(current+1);
	}   */
}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button6Click(TObject *Sender)
{
	Products* element=lst.Pop(lst.current);
	AnsiString str=Edit1->Text;
	element->name=str.c_str();
	str=Edit2->Text;
	element->quantity=StrToInt(str);
	element->WorkNumber=ComboBox3->ItemIndex;

	/*hosp[current].pol=ComboBox1->ItemIndex;
	hosp[current].age=StrToInt(Edit2->Text);
	str=Edit3->Text;
	hosp[current].diagnoz=str.c_str();
	hosp[current].number=ComboBox3->ItemIndex;*/
}
//---------------------------------------------------------------------------


void __fastcall TForm1::FormCreate(TObject *Sender)
{

	ComboBox3->Items->Add("Не выбран");
	ComboBox3->Items->Add("1");
	ComboBox3->Items->Add("2");
	ComboBox3->Items->Add("3");
	ComboBox3->Items->Add("4");
	ComboBox3->Items->Add("5");
	ComboBox3->ItemIndex=0;

	ComboBox2->Items->Add("ФИО");
	ComboBox2->Items->Add("Диагноз");
	ComboBox2->Items->Add("Номер палаты");
	ComboBox2->ItemIndex=0;

	Label6->Caption="Количество узлов: 0";
	Label7->Caption="Текущая текущий узел: 0";
}
//---------------------------------------------------------------------------

void TForm1::ObjToForm()
{
	Products* element=lst.Pop(lst.current);

	std::string str=element->name;
	Edit1->Text=str.c_str();
	Edit2->Text=IntToStr(element->quantity);
	ComboBox3->ItemIndex=element->WorkNumber;
}

void __fastcall TForm1::Button1Click(TObject *Sender)
{
	lst.AddList("",0,0);
	lst.size++;
	lst.current=lst.size-1;

	ObjToForm();

	Label6->Caption="Количество узлов: "+IntToStr(lst.size);;
	Label7->Caption="Текущая узел: "+IntToStr(lst.current+1);
}
//---------------------------------------------------------------------------

/*Hospital* TForm1::DeleteObjHosp(Hospital *Obj)
{
	Hospital* tmp = new Hospital[count - 1];

	  for (int j = 0; j <current ; j++)
	  {
		 tmp[j] = hosp[j];
	  }

	  for (int j = current; j < count - 1; j++)
	  {
		 tmp[j] = hosp[j + 1];
	  }
	delete[]hosp;
	hosp = tmp;
	count--;
}*/

void __fastcall TForm1::Button10Click(TObject *Sender)
{
	/*hosp=DeleteObjHosp(hosp);
	current=0;

	lst.AddList("",0,0);

	Label6->Caption="Количество узлов: "+IntToStr(count);;
	Label7->Caption="Текущая узел: "+IntToStr(current+1);*/
}
//---------------------------------------------------------------------------

